<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155377655-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-155377655-1');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Electro</title>

    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

    <!-- Bootstrap -->
    <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />

    <!-- Slick -->
    <link type="text/css" rel="stylesheet" href="css/slick.css" />
    <link type="text/css" rel="stylesheet" href="css/slick-theme.css" />

    <!-- nouislider -->
    <link type="text/css" rel="stylesheet" href="css/nouislider.min.css" />

    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- Custom stlylesheet -->
    <link type="text/css" rel="stylesheet" href="css/style.css" />

    <!-- Pagination -->
    <link type="text/css" rel="stylesheet" href="css/pagination.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

</head>

<body>
    <%include header.ejs%>
        <!-- BREADCRUMB -->
        <div id="breadcrumb" class="section">
            <!-- container -->
            <div class="container">
                <!-- row -->
                <div class="row">
                    <div class="col-md-12">
                        <ul class="breadcrumb-tree">
                            <li><a href="/">Trang chủ</a></li>
                            <li><a href="/store/filter?type=All">Sản phẩm</a></li>
                            <li class="active">
                                <%=item.ten%>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- /row -->
            </div>
            <!-- /container -->
        </div>
        <!-- /BREADCRUMB -->

        <!-- SECTION -->
        <div class="section">
            <!-- container -->
            <div class="container">
                <!-- row -->
                <div class="row">
                    <!-- Product main img -->
                    <div class="col-md-5 col-md-push-2">
                        <div id="product-main-img">
                            <div class="product-preview">
                                <img src="<%=item.anh%>" alt="">
                            </div>
                            <%Images.forEach(function(image){%>
                                <div class="product-preview">
                                    <img src="<%=image.img%>" alt="">
                                </div>
                                <%});%>
                        </div>
                    </div>
                    <!-- /Product main img -->

                    <!-- Product thumb imgs -->
                    <div class="col-md-2  col-md-pull-5">
                        <div id="product-imgs">
                            <div class="product-preview">
                                <img src="<%=item.anh%>" alt="">
                            </div>
                            <%Images.forEach(function(image){%>
                                <div class="product-preview">
                                    <img src="<%=image.img%>" alt="">
                                </div>
                                <%});%>
                        </div>
                    </div>
                    <!-- /Product thumb imgs -->

                    <!-- Product details -->
                    <div class="col-md-5">
                        <div class="product-details">
                            <h2 class="product-name">
                                <%= item.ten%>
                            </h2>
                            <div>
                                <h3 class="product-price">
                                    <%= new Intl.NumberFormat().format(item.gia)%>
                                </h3>
                                <span class="product-available">Còn hàng (<%= item.kho%>)</span>
                            </div>
                            <p>
                                <%= item.mota%>
                            </p>

                            <!-- <div class="add-to-cart">

                            <div class="qty-label">
                                Qty
                                <div class="input-number">
                                    <input type="number" value=1>
                                    <span class="qty-up">+</span>
                                    <span class="qty-down">-</span>
                                </div>
                            </div>
                            <form action="/cart/additem" method="post">
                                <div class="add-to-cart">
                                    <input type="hidden" name="stt" value="<%=item.id%>">
                                    <button type="submit" class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i>Thêm vào giỏ</button>
                                </div>
                            </form>
                            <button href="/cart" class="add-to-cart-btn"><i href="/cart" class="fa fa-shopping-cart"></i> add to cart</button>
                            <a href="/cart"><button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i>add to cart</button></a>
                        </div> -->

                            <ul class="product-links" style="margin-bottom: 24px;">
                                <li>Danh mục:</li>
                                <li>
                                    <a href="/store/filter?type=<%=item.loai%>&page=1">
                                        <%=item.loai%>
                                    </a>
                                </li>
                                <li>
                                    <a href="/store/filter?type=<%=item.brand%>&page=1">
                                        <%=item.brand%>
                                    </a>
                                </li>
                            </ul>

                            <% if (user) { %>
                                <form action="/cart/additem" method="post">
                                    <div class="add-to-cart">
                                        <input type="hidden" name="stt" value="<%=item.id%>">
                                        <button type="submit" class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i>Thêm vào giỏ</button>
                                    </div>
                                </form>
                                <% } else { %>
                                    <div class="add-to-cart">
                                        <button class="add-to-cart-btn add-to-local-cart-btn" data-toggle="popover" title="Đã thêm vào giỏ hàng" data-productid="<%= item.id %>" data-name="<%= item.ten %>" data-price="<%= item.gia %>" data-picture="<%= item.anh %>"><i class="fa fa-shopping-cart"></i>Thêm vào giỏ</button>
                                    </div>
                                    <% } %>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /product tab -->
        </div>
        <!-- /row -->

        <!-- Section -->
        <div class="section" style="margin-bottom: 0px; padding-bottom: 0px;">
            <!-- container -->
            <div class="container">
                <!-- row -->
                <div class="row">

                    <div class="col-md-12">
                        <div class="section-title text-center">
                            <h3 class="title">Sản phẩm tương tự</h3>
                        </div>
                    </div>
                    <div class="row">
                        <!-- product -->
                        <% Items.forEach(function(item){ %>
                            <div class="col-md-3 col-xs-6">
                                <a href="/store/id=<%=item.id%>">
                                    <div class="product">
                                        <div class="product-img">
                                            <img src="<%=item.anh%>" alt="">
                                        </div>
                                        <div class="product-body">
                                            <p class="product-category">
                                                <%= item.loai%>
                                            </p>
                                            <h3 class="product-name">
                                                <div>
                                                    <div class="line-clamp-3">
                                                        <%= item.ten%>
                                                    </div>
                                                </div>

                                            </h3>
                                            <h4 class="product-price">
                                                <%= new Intl.NumberFormat().format(item.gia)%>
                                            </h4>
                                            <div class="product-rating">
                                            </div>
                                            <% if (user) { %>
                                                <form action="/cart/additem" method="post">
                                                    <div class="add-to-cart">
                                                        <input type="hidden" name="stt" value="<%=item.id%>">
                                                        <button type="submit" class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i>Thêm vào giỏ</button>
                                                    </div>
                                                </form>
                                                <% } else { %>
                                                    <div class="add-to-cart">
                                                        <button class="add-to-cart-btn add-to-local-cart-btn" data-toggle="popover" title="Đã thêm vào giỏ hàng" data-productid="<%= item.id %>" data-name="<%= item.ten %>" data-price="<%= item.gia %>" data-picture="<%= item.anh %>"><i class="fa fa-shopping-cart"></i>Thêm vào giỏ</button>
                                                    </div>
                                                    <% } %>
                                        </div>
                                    </div>
                                </a>

                            </div>

                            <% }); %>
                    </div>
                    <!-- /row -->
                </div>
                <!-- /container -->
                <div class="container">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active show" id="contact-tab" data-toggle="tab" href="#" role="tab" aria-controls="contact" aria-selected="true">Bình luận</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane active show" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="comment_list">
                                        <div id="data-container"></div>
                                        <div id="pagination-container"></div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="review_box">
                                        <h4>Đăng bình luận</h4>
                                        <form class="row contact_form" action="/store/id=<%=item.id%>" method="post" id="contactForm" novalidate="novalidate">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input type="text" class="form-control" id="name" name="name" placeholder="Họ tên">
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <textarea class="form-control" name="message" id="message" rows="1" placeholder="Bình luận"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-md-12 text-right">
                                                <button type="submit" value="submit" class="btn primary-btn">Đăng</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Section -->

            <% include footer.ejs%>

                <!-- jQuery Plugins -->
                <script src="js/jquery.min.js"></script>
                <script src="js/bootstrap.min.js"></script>
                <script src="js/slick.min.js"></script>
                <script src="js/nouislider.min.js"></script>
                <script src="js/jquery.zoom.min.js"></script>
                <script src="js/main.js"></script>
                <script src="js/pagination.js"></script>
                <script type="text/javascript">
                    $(document).ready(function() {
                        function simpleTemplating(comments) {
                            var html = '<div>';
                            $.each(comments, function(index, comment) {
                                html += '<div class="review_item">'
                                html += '  <div class="media">'
                                html += '    <div class="media-body">'
                                html += '<tr>'
                                html += '      <th><h4>' + comment.name + '</h4></th>'
                                html += '</tr>'
                                html += '<tr>'
                                html += '      <th>' + comment.date + '</th>'
                                html += '</tr>'
                                html += '    </div>'
                                html += '  </div>'
                                html += '  <p>' + comment.content + '</p>'
                                html += '</div>'
                                html += '<br>'
                            });
                            html += '</div>';
                            return html;
                        }
                        var source = [
                            <% comments.forEach(function(comment){ %> {
                                name: '<%= comment.name %>',
                                content: '<%= comment.content %>',
                                date: '<%=new Date(comment.date).toLocaleString()%>'
                            },
                            <% }) %>
                        ]
                        $('#pagination-container').pagination({
                            dataSource: source,
                            pageSize: 2,
                            callback: function(data, pagination) {
                                var html = simpleTemplating(data);
                                $('#data-container').html(html);
                            }
                        })
                    });
                </script>

                <script type="text/javascript">
                    $(document).ready(function() {
                        $(".add-to-local-cart-btn").click(function(e) {
                            var cart = {}
                            if (localStorage.cart) {
                                cart = JSON.parse(localStorage.cart)
                            }

                            var productid = $(e.target).attr("data-productid")
                            var name = $(e.target).attr("data-name")
                            var price = $(e.target).attr("data-price")
                            var picture = $(e.target).attr("data-picture")
                            if (!cart[productid]) {
                                cart[productid] = {}
                                cart[productid]["name"] = name
                                cart[productid]["price"] = price
                                cart[productid]["picture"] = picture
                                cart[productid]["quantity"] = 1
                            } else {
                                cart[productid]["quantity"] = cart[productid]["quantity"] + 1
                            }
                            localStorage.cart = JSON.stringify(cart)
                        })
                    });
                </script>

                <script>
                    $(document).ready(function() {
                        $('[data-toggle="popover"]').popover({
                            placement: 'bottom',
                            delay: {
                                hide: 5000 // doesn't do anything
                            }
                        }).on('shown.bs.popover', function() {
                            setTimeout(function(a) {
                                a.popover('hide');
                            }, 500, $(this));
                        });
                    });
                </script>
</body>

</html>